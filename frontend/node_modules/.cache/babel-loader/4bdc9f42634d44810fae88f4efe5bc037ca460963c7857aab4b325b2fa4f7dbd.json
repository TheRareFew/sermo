{"ast":null,"code":"export const transformMessage = message => {\n  var _message$parent_id;\n  console.log('Transforming message:', {\n    id: message.id,\n    content: message.content.slice(0, 50),\n    // Only log first 50 chars\n    rawReactions: message.reactions\n  });\n\n  // Process reactions with detailed logging\n  let reactions = [];\n  if (message.reactions && Array.isArray(message.reactions)) {\n    console.log('Raw reactions array:', JSON.stringify(message.reactions, null, 2));\n    reactions = message.reactions.filter(r => {\n      if (!r || !r.emoji || !(r.user_id || r.userId)) {\n        console.warn('Invalid reaction:', r);\n        return false;\n      }\n      return true;\n    }).map(r => {\n      var _ref, _r$id;\n      console.log('Processing reaction:', JSON.stringify(r, null, 2));\n      const userId = (_ref = r.user_id || r.userId) === null || _ref === void 0 ? void 0 : _ref.toString();\n      if (!userId) {\n        console.warn('Missing user ID in reaction:', r);\n        return null;\n      }\n      const reaction = {\n        id: ((_r$id = r.id) === null || _r$id === void 0 ? void 0 : _r$id.toString()) || `${message.id}_${userId}_${r.emoji}`,\n        messageId: message.id.toString(),\n        userId,\n        emoji: r.emoji || '',\n        createdAt: r.created_at || r.createdAt || new Date().toISOString()\n      };\n      console.log('Transformed reaction:', reaction);\n      return reaction;\n    }).filter(r => {\n      if (!r) {\n        console.warn('Reaction was filtered out due to missing data');\n        return false;\n      }\n      return true;\n    });\n  } else {\n    console.log('No reactions found or reactions is not an array');\n  }\n  console.log('All processed reactions:', JSON.stringify(reactions, null, 2));\n  const transformed = {\n    id: message.id.toString(),\n    content: message.content,\n    channelId: (message.channel_id || '').toString(),\n    userId: (message.sender_id || '').toString(),\n    reactions,\n    attachments: Array.isArray(message.attachments) ? message.attachments : [],\n    createdAt: message.created_at,\n    updatedAt: message.updated_at || message.created_at,\n    parentId: (_message$parent_id = message.parent_id) === null || _message$parent_id === void 0 ? void 0 : _message$parent_id.toString(),\n    replyCount: message.reply_count || 0,\n    isExpanded: false\n  };\n  console.log('Transformed message:', {\n    id: transformed.id,\n    content: transformed.content.slice(0, 50),\n    // Only log first 50 chars\n    reactions: transformed.reactions\n  });\n  return transformed;\n};","map":{"version":3,"names":["transformMessage","message","_message$parent_id","console","log","id","content","slice","rawReactions","reactions","Array","isArray","JSON","stringify","filter","r","emoji","user_id","userId","warn","map","_ref","_r$id","toString","reaction","messageId","createdAt","created_at","Date","toISOString","transformed","channelId","channel_id","sender_id","attachments","updatedAt","updated_at","parentId","parent_id","replyCount","reply_count","isExpanded"],"sources":["Z:/GAUNTLET/projects/SERMO/sermo-app/frontend/src/utils/messageTransform.ts"],"sourcesContent":["import { Message, RawMessage, StoreMessage, Reaction, RawReaction } from '../types';\n\nexport const transformMessage = (message: RawMessage | Message): StoreMessage => {\n  console.log('Transforming message:', {\n    id: message.id,\n    content: message.content.slice(0, 50), // Only log first 50 chars\n    rawReactions: message.reactions\n  });\n  \n  // Process reactions with detailed logging\n  let reactions: Reaction[] = [];\n  if (message.reactions && Array.isArray(message.reactions)) {\n    console.log('Raw reactions array:', JSON.stringify(message.reactions, null, 2));\n    reactions = message.reactions\n      .filter((r: RawReaction) => {\n        if (!r || !r.emoji || !(r.user_id || r.userId)) {\n          console.warn('Invalid reaction:', r);\n          return false;\n        }\n        return true;\n      })\n      .map((r: RawReaction) => {\n        console.log('Processing reaction:', JSON.stringify(r, null, 2));\n        const userId = (r.user_id || r.userId)?.toString();\n        if (!userId) {\n          console.warn('Missing user ID in reaction:', r);\n          return null;\n        }\n        \n        const reaction = {\n          id: r.id?.toString() || `${message.id}_${userId}_${r.emoji}`,\n          messageId: message.id.toString(),\n          userId,\n          emoji: r.emoji || '',\n          createdAt: r.created_at || r.createdAt || new Date().toISOString()\n        };\n        console.log('Transformed reaction:', reaction);\n        return reaction;\n      })\n      .filter((r): r is Reaction => {\n        if (!r) {\n          console.warn('Reaction was filtered out due to missing data');\n          return false;\n        }\n        return true;\n      });\n  } else {\n    console.log('No reactions found or reactions is not an array');\n  }\n\n  console.log('All processed reactions:', JSON.stringify(reactions, null, 2));\n  \n  const transformed: StoreMessage = {\n    id: message.id.toString(),\n    content: message.content,\n    channelId: (message.channel_id || '').toString(),\n    userId: (message.sender_id || '').toString(),\n    reactions,\n    attachments: Array.isArray(message.attachments) ? message.attachments : [],\n    createdAt: message.created_at,\n    updatedAt: message.updated_at || message.created_at,\n    parentId: message.parent_id?.toString(),\n    replyCount: message.reply_count || 0,\n    isExpanded: false\n  };\n  \n  console.log('Transformed message:', {\n    id: transformed.id,\n    content: transformed.content.slice(0, 50), // Only log first 50 chars\n    reactions: transformed.reactions\n  });\n\n  return transformed;\n}; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}